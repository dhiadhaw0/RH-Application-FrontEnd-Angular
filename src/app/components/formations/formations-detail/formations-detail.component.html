<div class="formation-detail-container" *ngIf="formation">
  <!-- Hero Section with Formation Image and Basic Info -->
  <div class="formation-hero">
    <div class="hero-background">
      <div class="hero-overlay"></div>
      <img [src]="formation.imageUrl || 'assets/default-formation.jpg'" [alt]="formation.title" class="hero-image">
    </div>
    <div class="hero-content">
      <div class="hero-text">
        <div class="formation-category-badge">
          <span class="category-tag">{{ formation.domaine }}</span>
        </div>
        <h1 class="formation-title">{{ formation.title }}</h1>
        <p class="formation-subtitle">{{ formation.description | slice:0:200 }}...</p>

        <div class="formation-meta-grid">
          <div class="meta-item">
            <i class="fas fa-building"></i>
            <span>{{ formation.provider }}</span>
          </div>
          <div class="meta-item" *ngIf="formation.duree">
            <i class="fas fa-clock"></i>
            <span>{{ formation.duree }}</span>
          </div>
          <div class="meta-item" *ngIf="formation.niveau">
            <i class="fas fa-graduation-cap"></i>
            <span>{{ formation.niveau }}</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-play-circle"></i>
            <span>{{ formation.typeFormation }}</span>
          </div>
        </div>

        <div class="rating-price-section">
          <div class="rating-display" *ngIf="formation.noteMoyenne">
            <div class="rating-stars">
              <i class="fas fa-star" *ngFor="let star of [1,2,3,4,5]; let i = index"
                 [class.filled]="i < Math.floor(formation.noteMoyenne)"></i>
            </div>
            <span class="rating-value">{{ formation.noteMoyenne | number:'1.1-1' }}</span>
            <span class="rating-count">(0 avis)</span>
          </div>

          <div class="price-display">
            <span class="price-amount" *ngIf="formation.prix">{{ formation.prix | currency:'EUR':'symbol':'1.0-0' }}</span>
            <span class="price-free" *ngIf="!formation.prix">
              <i class="fas fa-gift"></i>
              100% Gratuit
            </span>
          </div>
        </div>
      </div>

      <div class="hero-actions">
        <button class="btn btn-primary btn-large" (click)="startFormation()">
          <i class="fas fa-play-circle"></i>
          Commencer Maintenant
        </button>
        <button class="btn btn-outline btn-large" (click)="toggleFavorite()">
          <i [class]="isFavorite ? 'fas fa-heart' : 'far fa-heart'"></i>
          {{ isFavorite ? 'Retirer des favoris' : 'Ajouter aux favoris' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Action Bar -->
  <div class="action-bar">
    <div class="action-buttons">
      <button class="action-btn" (click)="navigateToRating()">
        <i class="fas fa-star"></i>
        Noter
      </button>
      <button class="action-btn" (click)="navigateToStats()">
        <i class="fas fa-chart-bar"></i>
        Statistiques
      </button>
      <button class="action-btn" (click)="navigateToTranslation()">
        <i class="fas fa-language"></i>
        Traductions
      </button>
      <button class="action-btn edit" (click)="editFormation()">
        <i class="fas fa-edit"></i>
        Modifier
      </button>
      <button class="action-btn delete" (click)="deleteFormation()">
        <i class="fas fa-trash"></i>
        Supprimer
      </button>
    </div>
  </div>

  <!-- Main Content Sections -->
  <div class="content-sections">
    <!-- About Section -->
    <div class="content-section">
      <div class="section-header">
        <h2><i class="fas fa-info-circle"></i> À propos de cette formation</h2>
      </div>
      <div class="section-content">
        <p class="formation-description">{{ formation.description }}</p>
      </div>
    </div>

    <!-- Prerequisites Section -->
    <div class="content-section" *ngIf="formation.prerequis">
      <div class="section-header">
        <h2><i class="fas fa-clipboard-check"></i> Prérequis</h2>
      </div>
      <div class="section-content">
        <div class="prerequisites-list">
          <div class="prerequisite-item" *ngFor="let prereq of getPrerequisitesList()">
            <i class="fas fa-check-circle"></i>
            <span>{{ prereq }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Program Section -->
    <div class="content-section" *ngIf="formation.programme">
      <div class="section-header">
        <h2><i class="fas fa-book-open"></i> Programme détaillé</h2>
      </div>
      <div class="section-content">
        <div class="program-modules">
          <div class="module-item" *ngFor="let module of getProgramModules(); let i = index">
            <div class="module-header">
              <div class="module-number">{{ i + 1 }}</div>
              <div class="module-title">{{ module }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Certification Section -->
    <div class="content-section" *ngIf="formation.certification">
      <div class="section-header">
        <h2><i class="fas fa-certificate"></i> Certification</h2>
      </div>
      <div class="section-content">
        <div class="certification-info">
          <i class="fas fa-award certification-icon"></i>
          <div>
            <h3>{{ formation.certification }}</h3>
            <p>À l'issue de cette formation, vous recevrez une certification reconnue.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Lessons Section -->
    <div class="content-section" *ngIf="lessons.length > 0">
      <div class="section-header">
        <h2><i class="fas fa-play-circle"></i> Contenu de la formation</h2>
        <span class="section-count">{{ lessons.length }} leçons</span>
      </div>
      <div class="section-content">
        <div class="lessons-grid">
          <div class="lesson-card" *ngFor="let lesson of lessons; let i = index">
            <div class="lesson-number">{{ i + 1 }}</div>
            <div class="lesson-content">
              <h3>{{ lesson.titre }}</h3>
              <p>{{ lesson.description }}</p>
              <div class="lesson-meta">
                <span class="lesson-duration"><i class="fas fa-clock"></i> {{ lesson.duree }} min</span>
                <span class="lesson-type"><i class="fas fa-tag"></i> {{ lesson.typeLecon }}</span>
              </div>
            </div>
            <div class="lesson-play">
              <button class="btn-play-lesson">
                <i class="fas fa-play"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Certifications Section -->
    <div class="content-section" *ngIf="certifications.length > 0">
      <div class="section-header">
        <h2><i class="fas fa-award"></i> Certifications disponibles</h2>
        <span class="section-count">{{ certifications.length }} certifications</span>
      </div>
      <div class="section-content">
        <div class="certifications-grid">
          <div class="certification-card" *ngFor="let cert of certifications">
            <div class="certification-icon">
              <i class="fas fa-certificate"></i>
            </div>
            <div class="certification-content">
              <h3>{{ cert.nom }}</h3>
              <p>{{ cert.description }}</p>
              <div class="certification-meta">
                <span class="cert-level">{{ cert.niveau }}</span>
                <span class="cert-status" [class]="'status-' + cert.statut.toLowerCase()">{{ cert.statut }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Rating Section -->
    <div class="content-section rating-section">
      <div class="section-header">
        <h2><i class="fas fa-star"></i> Évaluez cette formation</h2>
      </div>
      <div class="section-content">
        <div class="rating-form">
          <p class="rating-prompt">Votre avis compte ! Partagez votre expérience avec la communauté.</p>
          <div class="rating-input">
            <div class="stars-input">
              <span
                class="star"
                *ngFor="let star of [1,2,3,4,5]"
                [class.selected]="star <= userRating"
                (click)="userRating = star">
                <i class="fas fa-star"></i>
              </span>
            </div>
            <div class="rating-text">
              <span *ngIf="userRating === 0">Cliquez sur les étoiles pour noter</span>
              <span *ngIf="userRating === 1">Très insatisfait</span>
              <span *ngIf="userRating === 2">Insatisfait</span>
              <span *ngIf="userRating === 3">Moyen</span>
              <span *ngIf="userRating === 4">Satisfait</span>
              <span *ngIf="userRating === 5">Excellent</span>
            </div>
          </div>
          <button class="btn-submit-rating" (click)="submitRating()" [disabled]="userRating === 0">
            <i class="fas fa-paper-plane"></i>
            Soumettre ma note
          </button>
        </div>
      </div>
    </div>

    <!-- Translations Section -->
    <div class="content-section" *ngIf="traductions.length > 0">
      <div class="section-header">
        <h2><i class="fas fa-language"></i> Traductions disponibles</h2>
        <span class="section-count">{{ traductions.length }} langues</span>
      </div>
      <div class="section-content">
        <div class="translations-grid">
          <button
            class="translation-btn"
            *ngFor="let trad of traductions"
            [class.active]="selectedLanguage === trad.langue"
            (click)="changeLanguage(trad.langue)">
            <span class="lang-code">{{ trad.langue.toUpperCase() }}</span>
            <span class="lang-name">{{ trad.langue === 'fr' ? 'Français' : trad.langue === 'en' ? 'English' : trad.langue === 'es' ? 'Español' : trad.langue }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="loading" *ngIf="!formation">
  <p>Chargement de la formation...</p>
</div>
