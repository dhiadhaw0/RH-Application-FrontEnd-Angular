<div class="achievements-dashboard">
  <div class="dashboard-header">
    <h1><i class="fas fa-trophy"></i> Achievements Dashboard</h1>
    <div class="header-actions">
      <button class="refresh-btn" (click)="refreshData()" [disabled]="loading">
        <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
        Refresh
      </button>
      <div class="auth-notice" *ngIf="!currentUserId">
        <i class="fas fa-info-circle"></i>
        Connectez-vous pour voir vos r√©compenses personnelles
      </div>
    </div>
  </div>

  <!-- User Points Summary -->
  <div class="points-summary" *ngIf="userPoints">
    <div class="points-card">
      <div class="points-info">
        <h3>{{ userPoints.totalPoints }} Points</h3>
        <p>Level {{ userPoints.level }}</p>
        <div class="progress-bar">
          <div class="progress-fill"
               [style.width.%]="(userPoints.experiencePoints / userPoints.nextLevelThreshold) * 100">
          </div>
        </div>
        <small>{{ userPoints.experiencePoints }} / {{ userPoints.nextLevelThreshold }} XP</small>
      </div>
      <div class="points-icon">
        <i class="fas fa-star"></i>
      </div>
    </div>
  </div>

  <!-- Recent Achievements -->
  <div class="recent-achievements" *ngIf="recentAchievements.length > 0">
    <h2><i class="fas fa-clock"></i> Recent Achievements</h2>
    <div class="achievements-grid">
      <div class="achievement-card unlocked" *ngFor="let userAchievement of recentAchievements">
        <div class="achievement-icon">
          <i [class]="userAchievement.achievement.iconUrl || 'fas fa-trophy'"></i>
        </div>
        <div class="achievement-info">
          <h4>{{ userAchievement.achievement.name }}</h4>
          <p>{{ userAchievement.achievement.description }}</p>
          <small class="unlock-date">
            Unlocked {{ userAchievement.unlockedAt | date:'short' }}
          </small>
        </div>
        <div class="achievement-points">
          +{{ userAchievement.achievement.points }}
        </div>
      </div>
    </div>
  </div>

  <!-- Achievement Categories -->
  <div class="categories-section">
    <h2><i class="fas fa-tags"></i> Achievement Categories</h2>
    <div class="category-tabs">
      <button class="category-tab"
              [class.active]="selectedCategory === category"
              (click)="selectCategory(category)"
              *ngFor="let category of categories | keyvalue">
        <i [class]="getCategoryIcon(category.key)"></i>
        {{ getCategoryName(category.key) }}
      </button>
    </div>

    <div class="achievements-grid">
      <div class="achievement-card"
           [class.unlocked]="getUserAchievementById(achievement.id)"
           *ngFor="let achievement of getAchievementsByCategory(selectedCategory)">
        <div class="achievement-icon" [class.locked]="!getUserAchievementById(achievement.id)">
          <i [class]="achievement.iconUrl || 'fas fa-trophy'"></i>
          <i class="fas fa-lock lock-icon" *ngIf="!getUserAchievementById(achievement.id)"></i>
        </div>
        <div class="achievement-info">
          <h4>{{ achievement.name }}</h4>
          <p>{{ achievement.description }}</p>
          <div class="progress-container" *ngIf="!getUserAchievementById(achievement.id) && achievement.triggerValue">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="getProgressPercentage(achievement)"></div>
            </div>
            <small>{{ getUserAchievementById(achievement.id)?.progress || 0 }} / {{ achievement.triggerValue }}</small>
          </div>
        </div>
        <div class="achievement-points">
          {{ achievement.points }} pts
        </div>
      </div>
    </div>
  </div>

  <!-- Active Challenges -->
  <div class="active-challenges" *ngIf="activeChallenges.length > 0">
    <h2><i class="fas fa-fire"></i> Active Challenges</h2>
    <div class="challenges-grid">
      <div class="challenge-card" *ngFor="let challenge of activeChallenges">
        <div class="challenge-header">
          <h4>{{ challenge.name }}</h4>
          <span class="challenge-points">{{ challenge.points }} pts</span>
        </div>
        <p>{{ challenge.description }}</p>
        <div class="challenge-progress" *ngIf="challenge.triggerValue">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getProgressPercentage(challenge)"></div>
          </div>
          <small>{{ getUserAchievementById(challenge.id)?.progress || 0 }} / {{ challenge.triggerValue }}</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Achievement Badges -->
  <div class="badges-section" *ngIf="achievementBadges.length > 0">
    <h2><i class="fas fa-medal"></i> Achievement Badges</h2>
    <div class="badges-grid">
      <div class="badge-item" *ngFor="let badge of achievementBadges">
        <div class="badge-icon">
          <i [class]="badge.imageUrl || 'fas fa-medal'"></i>
        </div>
        <div class="badge-info">
          <h4>{{ badge.nom }}</h4>
          <p>{{ badge.description }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
