<div class="invoice-create-container">
  <h2>Create New Invoice</h2>

  <form [formGroup]="invoiceForm" (ngSubmit)="onSubmit()" class="invoice-form">
    <!-- Client Information -->
    <div class="form-section">
      <h3>Client Information</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="clientName">Client Name *</label>
          <input
            type="text"
            id="clientName"
            formControlName="clientName"
            class="form-control"
            [class.error]="invoiceForm.get('clientName')?.invalid && invoiceForm.get('clientName')?.touched">
          <div class="error-message" *ngIf="invoiceForm.get('clientName')?.invalid && invoiceForm.get('clientName')?.touched">
            Client name is required
          </div>
        </div>
        <div class="form-group">
          <label for="clientEmail">Client Email *</label>
          <input
            type="email"
            id="clientEmail"
            formControlName="clientEmail"
            class="form-control"
            [class.error]="invoiceForm.get('clientEmail')?.invalid && invoiceForm.get('clientEmail')?.touched">
          <div class="error-message" *ngIf="invoiceForm.get('clientEmail')?.invalid && invoiceForm.get('clientEmail')?.touched">
            Valid email is required
          </div>
        </div>
      </div>
    </div>

    <!-- Invoice Details -->
    <div class="form-section">
      <h3>Invoice Details</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="issueDate">Issue Date *</label>
          <input
            type="date"
            id="issueDate"
            formControlName="issueDate"
            class="form-control">
        </div>
        <div class="form-group">
          <label for="dueDate">Due Date *</label>
          <input
            type="date"
            id="dueDate"
            formControlName="dueDate"
            class="form-control"
            [class.error]="invoiceForm.get('dueDate')?.invalid && invoiceForm.get('dueDate')?.touched">
          <div class="error-message" *ngIf="invoiceForm.get('dueDate')?.invalid && invoiceForm.get('dueDate')?.touched">
            Due date is required
          </div>
        </div>
        <div class="form-group">
          <label for="taxRate">Tax Rate (%) *</label>
          <input
            type="number"
            id="taxRate"
            formControlName="taxRate"
            class="form-control"
            min="0"
            max="100"
            step="0.01">
        </div>
      </div>
    </div>

    <!-- Invoice Items -->
    <div class="form-section">
      <h3>Invoice Items</h3>
      <div formArrayName="items">
        <div
          *ngFor="let item of items.controls; let i = index"
          [formGroupName]="i"
          class="item-row">
          <div class="form-row">
            <div class="form-group flex-3">
              <label>Description *</label>
              <input
                type="text"
                formControlName="description"
                class="form-control"
                placeholder="Item description">
            </div>
            <div class="form-group flex-1">
              <label>Qty *</label>
              <input
                type="number"
                formControlName="quantity"
                class="form-control"
                min="1"
                placeholder="1">
            </div>
            <div class="form-group flex-1">
              <label>Unit Price *</label>
              <input
                type="number"
                formControlName="unitPrice"
                class="form-control"
                min="0"
                step="0.01"
                placeholder="0.00">
            </div>
            <div class="form-group flex-1">
              <label>Total</label>
              <input
                type="text"
                [value]="calculateItemTotal(items.at(i))"
                class="form-control"
                readonly>
            </div>
            <div class="form-group flex-0">
              <button
                type="button"
                (click)="removeItem(i)"
                class="btn btn-danger btn-sm"
                [disabled]="items.length <= 1">
                Remove
              </button>
            </div>
          </div>
        </div>
      </div>
      <button type="button" (click)="addItem()" class="btn btn-secondary">Add Item</button>
    </div>

    <!-- Summary -->
    <div class="form-section summary-section">
      <h3>Summary</h3>
      <div class="summary-row">
        <span>Subtotal:</span>
        <span>${{ getSubtotal() }}</span>
      </div>
      <div class="summary-row">
        <span>Tax ({{ invoiceForm.get('taxRate')?.value }}%):</span>
        <span>${{ getTaxAmount() }}</span>
      </div>
      <div class="summary-row total-row">
        <span>Total:</span>
        <span>${{ getTotal() }}</span>
      </div>
    </div>

    <!-- Notes -->
    <div class="form-section">
      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea
          id="notes"
          formControlName="notes"
          class="form-control"
          rows="3"
          placeholder="Additional notes..."></textarea>
      </div>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button type="button" (click)="cancel()" class="btn btn-secondary">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="invoiceForm.invalid || isLoading">
        <span *ngIf="isLoading">Creating...</span>
        <span *ngIf="!isLoading">Create Invoice</span>
      </button>
    </div>
  </form>
</div>
