<div class="payment-methods-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1><i class="fas fa-credit-card"></i> Payment Methods</h1>
      <p>Manage your payment methods for seamless transactions</p>
    </div>
    <button class="btn btn-primary" (click)="showAddPaymentMethod()" *ngIf="!showAddForm">
      <i class="fas fa-plus"></i> Add Payment Method
    </button>
  </div>

  <!-- Add/Edit Form -->
  <div class="form-section" *ngIf="showAddForm">
    <div class="form-card">
      <div class="form-header">
        <h3>{{ editingMethod ? 'Edit Payment Method' : 'Add New Payment Method' }}</h3>
        <button class="btn-close" (click)="cancelEdit()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [formGroup]="paymentMethodForm" (ngSubmit)="savePaymentMethod()">
        <!-- Payment Type Selection -->
        <div class="form-group">
          <label for="type">Payment Type</label>
          <select id="type" formControlName="type" (change)="onTypeChange()" class="form-control">
            <option *ngFor="let type of paymentTypes" [value]="type">
              {{ type.replace('_', ' ') }}
            </option>
          </select>
        </div>

        <!-- Provider Selection -->
        <div class="form-group" *ngIf="selectedType === 'CREDIT_CARD'">
          <label for="provider">Card Provider</label>
          <select id="provider" formControlName="provider" class="form-control">
            <option *ngFor="let provider of cardProviders" [value]="provider">
              {{ provider.replace('_', ' ') }}
            </option>
          </select>
        </div>

        <!-- Nickname -->
        <div class="form-group">
          <label for="nickname">Nickname (Optional)</label>
          <input type="text" id="nickname" formControlName="nickname" class="form-control"
                 placeholder="e.g., Primary Visa, Work Card">
        </div>

        <!-- Credit Card Fields -->
        <div *ngIf="selectedType === 'CREDIT_CARD'" class="card-fields">
          <div class="form-row">
            <div class="form-group">
              <label for="cardNumber">Card Number</label>
              <input type="text" id="cardNumber" formControlName="cardNumber" class="form-control"
                     placeholder="1234 5678 9012 3456" maxlength="19">
              <div class="field-error" *ngIf="paymentMethodForm.get('cardNumber')?.invalid && paymentMethodForm.get('cardNumber')?.touched">
                Valid card number is required
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="expiryMonth">Expiry Month</label>
              <select id="expiryMonth" formControlName="expiryMonth" class="form-control">
                <option value="">Month</option>
                <option *ngFor="let month of [].constructor(12); let i = index" [value]="i + 1">
                  {{ (i + 1).toString().padStart(2, '0') }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="expiryYear">Expiry Year</label>
              <select id="expiryYear" formControlName="expiryYear" class="form-control">
                <option value="">Year</option>
                <option *ngFor="let year of [].constructor(10); let i = index" [value]="currentYear + i">
                  {{ currentYear + i }}
                </option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="cvc">CVC</label>
              <input type="text" id="cvc" formControlName="cvc" class="form-control"
                     placeholder="123" maxlength="4">
            </div>
            <div class="form-group">
              <label for="holderName">Cardholder Name</label>
              <input type="text" id="holderName" formControlName="holderName" class="form-control"
                     placeholder="John Doe">
            </div>
          </div>
        </div>

        <!-- Bank Account Fields -->
        <div *ngIf="selectedType === 'BANK_ACCOUNT'" class="bank-fields">
          <div class="form-row">
            <div class="form-group">
              <label for="accountNumber">Account Number</label>
              <input type="text" id="accountNumber" formControlName="accountNumber" class="form-control"
                     placeholder="123456789">
            </div>
            <div class="form-group">
              <label for="routingNumber">Routing Number</label>
              <input type="text" id="routingNumber" formControlName="routingNumber" class="form-control"
                     placeholder="123456789">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="accountType">Account Type</label>
              <select id="accountType" formControlName="accountType" class="form-control">
                <option value="CHECKING">Checking</option>
                <option value="SAVINGS">Savings</option>
              </select>
            </div>
            <div class="form-group">
              <label for="holderName">Account Holder Name</label>
              <input type="text" id="holderName" formControlName="holderName" class="form-control"
                     placeholder="John Doe">
            </div>
          </div>
        </div>

        <!-- PayPal Fields -->
        <div *ngIf="selectedType === 'PAYPAL'" class="paypal-fields">
          <div class="form-group">
            <label for="email">PayPal Email</label>
            <input type="email" id="email" formControlName="email" class="form-control"
                   placeholder="your-email@example.com">
          </div>
        </div>

        <!-- Digital Wallet Fields -->
        <div *ngIf="selectedType === 'APPLE_PAY' || selectedType === 'GOOGLE_PAY'" class="wallet-fields">
          <div class="form-group">
            <label for="deviceId">Device ID</label>
            <input type="text" id="deviceId" formControlName="deviceId" class="form-control"
                   placeholder="Device identifier">
          </div>
        </div>

        <!-- Currency Selection -->
        <div class="form-group">
          <label for="currency">Currency</label>
          <select id="currency" formControlName="currency" class="form-control">
            <option *ngFor="let currency of currencies" [value]="currency">
              {{ currency }}
            </option>
          </select>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="paymentMethodForm.invalid">
            {{ editingMethod ? 'Update' : 'Add' }} Payment Method
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Payment Methods List -->
  <div class="methods-section">
    <div class="methods-grid">
      <div *ngFor="let method of paymentMethods" class="method-card">
        <div class="method-header">
          <div class="method-icon">
            <i [class]="getPaymentMethodIcon(method.type, method.provider)"></i>
          </div>
          <div class="method-actions">
            <button class="btn-icon" (click)="editPaymentMethod(method)" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon btn-danger" (click)="deletePaymentMethod(method)" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>

        <div class="method-details">
          <div class="method-name">
            {{ method.nickname || 'Card ending in ' + method.lastFour }}
          </div>
          <div class="method-type">
            {{ method.type.replace('_', ' ') }}
            <span *ngIf="method.provider" class="provider-badge">{{ method.provider }}</span>
          </div>
          <div class="method-info" *ngIf="method.type === 'CREDIT_CARD'">
            <span class="card-number">{{ maskCardNumber('**** **** **** ' + method.lastFour) }}</span>
            <span class="expiry" *ngIf="method.expiryMonth && method.expiryYear">
              {{ formatExpiryDate(method.expiryMonth, method.expiryYear) }}
            </span>
          </div>
        </div>

        <div class="method-footer">
          <div class="method-status">
            <span class="status-badge" [ngClass]="method.isVerified ? 'verified' : 'unverified'">
              <i class="fas" [class]="method.isVerified ? 'fa-check-circle' : 'fa-exclamation-triangle'"></i>
              {{ method.isVerified ? 'Verified' : 'Unverified' }}
            </span>
            <span class="default-badge" *ngIf="method.isDefault">Default</span>
          </div>
          <div class="method-controls">
            <button class="btn btn-sm btn-outline-primary" (click)="setDefaultPaymentMethod(method)"
                    *ngIf="!method.isDefault">
              Set as Default
            </button>
            <button class="btn btn-sm btn-outline-secondary" (click)="verifyPaymentMethod(method)"
                    *ngIf="!method.isVerified">
              Verify
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="paymentMethods.length === 0" class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-credit-card"></i>
        </div>
        <h3>No Payment Methods</h3>
        <p>Add your first payment method to start making transactions</p>
        <button class="btn btn-primary" (click)="showAddPaymentMethod()">
          <i class="fas fa-plus"></i> Add Payment Method
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
    <p>Loading payment methods...</p>
  </div>
</div>
