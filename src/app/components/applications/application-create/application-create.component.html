<app-navbar></app-navbar>

<div class="application-create-container">
  <div class="header-section">
    <div class="breadcrumb">
      <a routerLink="/applications" class="breadcrumb-link">
        <i class="fas fa-arrow-left"></i> Retour aux candidatures
      </a>
    </div>
    <h1>Créer une Nouvelle Candidature</h1>
  </div>

  <form [formGroup]="applicationForm" (ngSubmit)="onSubmit()" class="application-form">
    <div class="form-grid">
      <!-- Basic Information -->
      <div class="form-section">
        <h2>Informations de Base</h2>

        <div class="form-group">
          <label for="jobOfferId">Offre d'Emploi *</label>
          <select id="jobOfferId" formControlName="jobOfferId" class="form-control" required>
            <option value="">Sélectionner une offre d'emploi</option>
            <option *ngFor="let offer of availableJobOffers" [value]="offer.idJobOffer">
              {{offer.title}} (ID: {{offer.idJobOffer}})
            </option>
          </select>
          <div class="error-message" *ngIf="applicationForm.get('jobOfferId')?.invalid && applicationForm.get('jobOfferId')?.touched">
            L'offre d'emploi est requise
          </div>
        </div>

        <div class="form-group">
          <label for="userId">Utilisateur *</label>
          <select id="userId" formControlName="userId" class="form-control" required>
            <option value="">Sélectionner un utilisateur</option>
            <option *ngFor="let user of availableUsers" [value]="user.id">
              {{user.firstName}} {{user.lastName}} (ID: {{user.id}})
            </option>
          </select>
          <div class="error-message" *ngIf="applicationForm.get('userId')?.invalid && applicationForm.get('userId')?.touched">
            L'utilisateur est requis
          </div>
        </div>
      </div>

      <!-- Motivation Section -->
      <div class="form-section">
        <h2>Lettres de Motivation</h2>

        <div class="form-group">
          <label for="motivationLetter">Lettre de Motivation</label>
          <textarea id="motivationLetter" formControlName="motivationLetter" class="form-control"
                    rows="8" placeholder="Rédigez votre lettre de motivation..."></textarea>
          <div class="character-count">
            {{applicationForm.get('motivationLetter')?.value?.length || 0}}/2000 caractères
          </div>
        </div>

        <div class="form-group">
          <label for="coverLetter">Lettre de Couverture</label>
          <textarea id="coverLetter" formControlName="coverLetter" class="form-control"
                    rows="6" placeholder="Rédigez votre lettre de couverture..."></textarea>
          <div class="character-count">
            {{applicationForm.get('coverLetter')?.value?.length || 0}}/1500 caractères
          </div>
        </div>
      </div>

      <!-- Documents Section -->
      <div class="form-section">
        <h2>Documents</h2>

        <div class="documents-upload">
          <div class="upload-area" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
            <div class="upload-content">
              <i class="fas fa-cloud-upload-alt"></i>
              <p>Glissez-déposez vos fichiers ici ou</p>
              <button type="button" class="btn btn-outline" (click)="fileInput.click()">
                Parcourir les fichiers
              </button>
              <input #fileInput type="file" multiple (change)="onFileSelected($event)" style="display: none;">
            </div>
          </div>

          <div class="uploaded-files" *ngIf="uploadedFiles.length > 0">
            <h4>Fichiers sélectionnés:</h4>
            <div class="file-item" *ngFor="let file of uploadedFiles; let i = index">
              <div class="file-info">
                <i class="fas fa-file-alt"></i>
                <span>{{file.name}}</span>
                <small>({{file.size}} bytes)</small>
              </div>
              <button type="button" class="btn btn-sm btn-danger" (click)="removeFile(i)">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Preview Section -->
      <div class="form-section">
        <h2>Aperçu</h2>
        <div class="preview-card" *ngIf="applicationForm.valid">
          <h3>Résumé de la Candidature</h3>
          <div class="preview-content">
            <p><strong>Offre d'emploi:</strong> {{getSelectedJobOffer()?.title}}</p>
            <p><strong>Candidat:</strong> {{getSelectedUser()?.firstName}} {{getSelectedUser()?.lastName}}</p>
            <p><strong>Lettre de motivation:</strong> {{applicationForm.get('motivationLetter')?.value ? 'Oui' : 'Non'}}</p>
            <p><strong>Lettre de couverture:</strong> {{applicationForm.get('coverLetter')?.value ? 'Oui' : 'Non'}}</p>
            <p><strong>Documents:</strong> {{uploadedFiles.length}} fichier(s)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-outline" routerLink="/applications">
        Annuler
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="applicationForm.invalid || isSubmitting">
        <i class="fas fa-save" *ngIf="!isSubmitting"></i>
        <i class="fas fa-spinner fa-spin" *ngIf="isSubmitting"></i>
        {{isSubmitting ? 'Création...' : 'Créer la Candidature'}}
      </button>
    </div>
  </form>
</div>